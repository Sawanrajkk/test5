{
  "source_file": "test_when_canceling_copy_using_add_page_ui.py",
  "lines": [
    "import logging\n",
    "import time\n",
    "import sys\n",
    "from dunetuf.emulation.scan import ScanEmulation\n",
    "\n",
    "from tests.copy.copy_base import TestGivenEmptyQueueAndEmptyHistoryUI\n",
    "\n",
    "\n",
    "class TestWhenCancellingCopyUsingAddPageUI(\n",
    "    TestGivenEmptyQueueAndEmptyHistoryUI\n",
    "):\n",
    "    @classmethod\n",
    "    def setup_class(cls):\n",
    "        \"\"\"Initialize shared test resources.\"\"\"\n",
    "        super().setup_class()\n",
    "        scan_simulator_ip = sys.argv[sys.argv.index('scanSimulatorIP') + 1] if 'scanSimulatorIP' in sys.argv else None\n",
    "        scan_simulator_ip = None if scan_simulator_ip == 'None' else scan_simulator_ip\n",
    "        logging.info('Instantiating ScanEmulation with %s', scan_simulator_ip)\n",
    "        cls.scan_emulation = ScanEmulation(cls.cdm, cls.udw, cls.tcl, scan_simulator_ip)\n",
    "\n",
    "    @classmethod\n",
    "    def teardown_class(cls):\n",
    "        \"\"\"Clean up shared test resources.\"\"\"\n",
    "        super().teardown_class()\n",
    "        \n",
    "    def setup_method(self):\n",
    "        self.scan_emulation.media.unload_media(\"ADF\")\n",
    "        self.scan_emulation.media.load_media(\"Flatbed\")\n",
    "\n",
    "    def teardown_method(self):\n",
    "        \"\"\"Clean up resources after each test.\"\"\"\n",
    "        self.spice.goto_homescreen()\n",
    "        self.spice.wait_ready()\n",
    "\n",
    "        # Clear job queue\n",
    "        self.job_queue.cancel_all_jobs()\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Clear job history\n",
    "        self.job_history.clear()\n",
    "        self.job_history.wait_for_history_empty()\n",
    "\n",
    "        # Restore default ticket\n",
    "        response = self.update_default_ticket_if_required(self.default_ticket)\n",
    "        assert response == 200\n",
    "        \n",
    "        self.scan_emulation.media.unload_media(\"Flatbed\")\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Test the flatbed 2_1Sided addPage prompt cancel scenario\n",
    "        +test_tier: 3\n",
    "        +is_manual: False\n",
    "        +test_classification: System\n",
    "        +reqid: DUNE-161762\n",
    "        +timeout: 300\n",
    "        +asset: Copy\n",
    "        +delivery_team: WalkupApps\n",
    "        +feature_team: CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingCopyUsingAddPageUI::test_when_using_flatbed_2_1_sided_collate_off_then_cancels\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headed\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingCopyUsingAddPageUI::test_when_using_flatbed_2_1_sided_collate_off_then_cancels\n",
    "            +guid:09dcc95a-315c-492b-bc7f-58afee0ce065\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=Flatbed & Copy=2Sided2To1 & FlatbedSettings=DuplexPrompt\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "        \n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_using_flatbed_2_1_sided_collate_off_then_cancels(self):\n",
    "        loadMedia = \"Flatbed\"\n",
    "        start_copy = True\n",
    "        options = {\"sides\": \"2_1_sided\", \"collate\": \"off\"}\n",
    "        self.spice.copy_ui().copy_add_page_general_method(\n",
    "            options, self.udw, loadMedia, start_copy\n",
    "        )\n",
    "        # Scan more than one page\n",
    "        self.spice.copy_ui().duplex_add_page_pop_up_add_more()\n",
    "        time.sleep(1) # To find cancel button in next prompt\n",
    "        self.spice.copy_ui().duplex_add_page_pop_up_cancel()\n",
    "        time.sleep(1) # To find cancel button in next prompt\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel_no()\n",
    "        time.sleep(1) # To find cancel button in next prompt\n",
    "        self.spice.copy_ui().duplex_add_page_pop_up_cancel()\n",
    "        time.sleep(1) # To find cancel button in next prompt\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel_yes()\n",
    "\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Test the flatbed 1_1Sided addPage prompt cancel scenario\n",
    "        +test_tier: 3\n",
    "        +is_manual: False\n",
    "        +test_classification: System\n",
    "        +reqid: DUNE-161757\n",
    "        +timeout: 240\n",
    "        +asset: Copy\n",
    "        +delivery_team: WalkupApps\n",
    "        +feature_team: CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingCopyUsingAddPageUI::test_when_using_flatbed_1_1_sided_then_cancels\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headed\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingCopyUsingAddPageUI::test_when_using_flatbed_1_1_sided_then_cancels\n",
    "            +guid:68b49abb-4cc0-4ed2-b6e0-a01d19114f3f\n",
    "            +dut:\n",
    "                +type: Simulator\n",
    "                +configuration: DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=Flatbed & FlatbedSettings=DuplexPrompt\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "        \n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_using_flatbed_1_1_sided_then_cancels(self):\n",
    "        loadMedia = \"Flatbed\"\n",
    "        start_copy = True\n",
    "        options = {\n",
    "            \"sides\": \"1_1_sided\",\n",
    "            \"collate\": \"off\",\n",
    "            \"scan_scanMode\": \"standard\",\n",
    "            \"checkBox_for_scan_mode_prompt\": True,\n",
    "        }\n",
    "        self.spice.goto_homescreen()\n",
    "        self.spice.copy_ui().copy_add_page_general_method(\n",
    "            options, self.udw, loadMedia, start_copy\n",
    "        )\n",
    "        # Scan more than one page\n",
    "        self.spice.copy_ui().add_page_pop_up_add_more()\n",
    "        self.spice.copy_ui().validate_add_page_prompt_media_size_list_content(self.cdm)\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel()\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel_no()\n",
    "        self.spice.copy_ui().validate_add_page_prompt_media_size_list_content(self.cdm)\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel()\n",
    "        self.spice.copy_ui().add_page_pop_up_cancel_yes()\n",
    "\n",
    "        # Check the job status of copy operation performed\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n"
  ]
}