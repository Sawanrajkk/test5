{
  "source_file": "test_when_cancelling_a_copy_job.py",
  "lines": [
    "import logging\n",
    "from typing import Dict\n",
    "import sys\n",
    "from dunetuf.emulation.scan import ScanEmulation\n",
    "\n",
    "from tests.copy.copy_base import TestGivenEmptyQueueAndEmptyHistory\n",
    "from tests.copy.copy_utils import create_and_start_copy_job\n",
    "\n",
    "class TestWhenCancellingACopyJob(TestGivenEmptyQueueAndEmptyHistory):\n",
    "    @classmethod\n",
    "    def setup_class(cls):\n",
    "        \"\"\"Initialize shared test resources.\"\"\"\n",
    "        super().setup_class()\n",
    "        scan_simulator_ip = sys.argv[sys.argv.index('scanSimulatorIP') + 1] if 'scanSimulatorIP' in sys.argv else None\n",
    "        scan_simulator_ip = None if scan_simulator_ip == 'None' else scan_simulator_ip\n",
    "        logging.info('Instantiating ScanEmulation with %s', scan_simulator_ip)\n",
    "        cls.scan_emulation = ScanEmulation(cls.cdm, cls.udw, cls.tcl, scan_simulator_ip)\n",
    "\n",
    "    @classmethod\n",
    "    def teardown_class(cls):\n",
    "        \"\"\"Clean up shared test resources.\"\"\"\n",
    "        super().teardown_class()\n",
    "\n",
    "    def setup_method(self):\n",
    "        self.payload = {\n",
    "            \"src\": {\n",
    "                \"scan\": {\n",
    "                    \"mediaSize\": \"na_letter_8.5x11in\",\n",
    "                    \"plexMode\": \"simplex\",\n",
    "                    \"resolution\": \"e300Dpi\",\n",
    "                },\n",
    "            },\n",
    "            \"dest\": {\n",
    "                \"print\": {\n",
    "                    \"copies\": 10,\n",
    "                    \"mediaSize\": \"na_letter_8.5x11in\",\n",
    "                    \"plexMode\": \"simplex\",\n",
    "                }\n",
    "            },\n",
    "        }\n",
    "\n",
    "    def teardown_method(self):\n",
    "        \"\"\"Clean up resources after each test.\"\"\"\n",
    "        # Clear job queue\n",
    "        self.job_queue.cancel_all_jobs()\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Clear job history\n",
    "        self.job_history.clear()\n",
    "        self.job_history.wait_for_history_empty()\n",
    "\n",
    "        # Restore default ticket\n",
    "        response = self.update_default_ticket_if_required(self.default_ticket)\n",
    "        assert response == 200\n",
    "\n",
    "    def initialize_copy_job(self, payload):\n",
    "\n",
    "        # Create and initialize copy job\n",
    "        ticket_id = self.copy.create_ticket(payload)\n",
    "        job_id = self.copy.create_job(ticket_id)\n",
    "        self.copy.wait_for_state(job_id, [\"created\"])\n",
    "\n",
    "        response = self.copy.change_job_state(\n",
    "            job_id, \"Initialize\", \"initializeProcessing\"\n",
    "        )\n",
    "        assert response == 200, f\"Copy job initialize failed with status {response}\"\n",
    "\n",
    "        return job_id\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after init\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_a_flatbed_copy_job_after_initializing_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:JobDetails\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_a_flatbed_copy_job_after_initializing_then_cancelled\n",
    "            +guid: 65a89874-b304-4838-b1fa-0a7f55b8884f\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=Flatbed\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_a_flatbed_copy_job_after_initializing_then_cancelled(\n",
    "        self,\n",
    "    ):\n",
    "        # test_copy_cancel_flatbed_after_init_cdm_and_state_changes\n",
    "        self.scan_emulation.media.unload_media(\"ADF\")\n",
    "\n",
    "        job_id = self.initialize_copy_job(self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        job_in_history = self.job_history.get_job(job_id)\n",
    "        assert len(job_in_history) == 0, 'Unexpected job in job history!'\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after start\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_a_adf_copy_job_after_starting_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_a_adf_copy_job_after_starting_then_cancelled\n",
    "            +guid: 7a62b6be-85cb-433e-a7d3-81d0ce04d4a0\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=AutomaticDocumentFeeder\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_a_adf_copy_job_after_starting_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_cancel_adf_after_start_cdm_and_state_changes\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "        job_id = create_and_start_copy_job(self.copy, self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\")\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after init\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_a_adf_copy_job_after_initializing_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_a_adf_copy_job_after_initializing_then_cancelled\n",
    "            +guid: b6912138-ad92-4a3f-b2cb-2eae1fa920b9\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=AutomaticDocumentFeeder\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_a_adf_copy_job_after_initializing_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_cancel_adf_after_init_cdm_and_state_changes\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "        job_id = self.initialize_copy_job(self.payload)        \n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        job_in_history = self.job_history.get_job(job_id)\n",
    "        assert len(job_in_history) == 0, 'Unexpected job in job history!'\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\")\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after start\n",
    "        +test_tier: 3\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_a_flatbed_copy_job_after_starting_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_a_flatbed_copy_job_after_starting_then_cancelled\n",
    "            +guid: 1e91ec71-244a-442f-8aa6-07cfd63cbfeb\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=Flatbed\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_a_flatbed_copy_job_after_starting_then_cancelled(\n",
    "        self,\n",
    "    ):\n",
    "        # test_copy_cancel_flatbed_after_start_cdm_and_state_changes\n",
    "        self.scan_emulation.media.unload_media(\"ADF\")\n",
    "        job_id = create_and_start_copy_job(self.copy, self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after start\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +test_framework: TUF\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_adf_copy_job_after_starting_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:JobDetails\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_adf_copy_job_after_starting_then_cancelled\n",
    "            +guid: 64bf3b3b-bd1e-4525-9d88-3cf8250f2f61\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=AutomaticDocumentFeeder\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_adf_copy_job_after_starting_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_job_cancel_adf_after_start_cdm_and_state_changes\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "        if self.cdm.device_feature_cdm.is_color_supported():\n",
    "            color_mode = \"color\"\n",
    "        else:\n",
    "            color_mode = \"grayscale\"\n",
    "        self.payload[\"src\"][\"scan\"][\"colorMode\"] = color_mode\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "        job_id = create_and_start_copy_job(self.copy, self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\")\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after init\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +test_framework: TUF\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_adf_copy_job_after_initializing_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Negative\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_adf_copy_job_after_initializing_then_cancelled\n",
    "            +guid: 6fb49ffe-a599-448a-a92a-9dbb5b697ded\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration: ScannerInput=AutomaticDocumentFeeder & DeviceClass=MFP & DeviceFunction=Copy\n",
    "\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_adf_copy_job_after_initializing_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_cdm_job_cancel_adf_after_init_state_changes\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "        if self.cdm.device_feature_cdm.is_color_supported():\n",
    "            color_mode = \"color\"\n",
    "        else:\n",
    "            color_mode = \"grayscale\"\n",
    "        self.payload[\"src\"][\"scan\"][\"colorMode\"] = color_mode        \n",
    "\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "        job_id = self.initialize_copy_job(self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        job_in_history = self.job_history.get_job(job_id)\n",
    "        assert len(job_in_history) == 0, 'Unexpected job in job history!'        \n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Verify mutilple copy job cancel state with copies.\n",
    "        +test_tier: 3\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-161363\n",
    "        +timeout:300\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_multiple_jobs_after_starting_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:CopySettings\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_multiple_jobs_after_starting_then_cancelled\n",
    "            +guid: 90f2050f-2861-471a-a24e-c0e1e7eaecf7\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration:DeviceFunction=Copy & ScannerInput=AutomaticDocumentFeeder & ScanOriginalSides=2-sided & ADFResolution=600dpi\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_multiple_jobs_after_starting_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        self.udw.mainApp.ScanDeviceService.setNumScanPages(10)\n",
    "        self.scan_emulation.media.load_media(\"ADF\")\n",
    "        job_id = create_and_start_copy_job(self.copy)\n",
    "        self.copy.cancel(job_id)\n",
    "        job_id = create_and_start_copy_job(self.copy)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        self.job_history.wait_for_jobs(expected_jobs=2)\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "        assert history[1][\"jobType\"] == \"copy\"\n",
    "        assert history[1][\"completionState\"] == \"cancelled\"\n",
    "\n",
    "        self.udw.mainApp.ScanDeviceService.setNumScanPages(1)\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after start\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_copy_after_starting_with_flatbed_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:JobDetails\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_copy_after_starting_with_flatbed_then_cancelled\n",
    "            +guid: 5b7c6c8a-4988-411e-95c1-672f0fbd2006\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration: ScannerInput=Flatbed & DeviceClass=MFP\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_copy_after_starting_with_flatbed_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_job_cancel_flatbed_after_start_cdm_and_state_changes\n",
    "        self.scan_emulation.media.unload_media(\"ADF\")\n",
    "\n",
    "        job_id = create_and_start_copy_job(self.copy, self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        self.job_history.wait_for_jobs()\n",
    "        history = self.job_history.get()\n",
    "        assert history[0][\"jobType\"] == \"copy\"\n",
    "        assert history[0][\"completionState\"] == \"cancelled\"\n",
    "\n",
    "        # For Simulator default scan resouce is ADF, then need to reload ADF end of testing\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n",
    "\n",
    "\n",
    "    \"\"\"\n",
    "    $$$$$_BEGIN_TEST_METADATA_DECLARATION_$$$$$\n",
    "        +purpose: Simple copy cancel after init\n",
    "        +test_tier: 1\n",
    "        +is_manual: False\n",
    "        +test_classification:System\n",
    "        +reqid: DUNE-9875\n",
    "        +timeout:120\n",
    "        +asset: Copy\n",
    "        +delivery_team:WalkupApps\n",
    "        +feature_team:CopySolns\n",
    "        +test_framework: TUF\n",
    "        +name: TestWhenCancellingACopyJob::test_when_cancelling_copy_after_initializing_with_flatbed_then_cancelled\n",
    "        +categorization:\n",
    "            +segment:Platform\n",
    "            +area:Copy\n",
    "            +feature:JobDetails\n",
    "            +sub_feature:\n",
    "            +interaction:Headless\n",
    "            +test_type:Positive\n",
    "        +test:\n",
    "            +title:TestWhenCancellingACopyJob::test_when_cancelling_copy_after_initializing_with_flatbed_then_cancelled\n",
    "            +guid: 5b7c6c8a-4988-411e-95c1-672f0fbd2117\n",
    "            +dut:\n",
    "                +type:Simulator\n",
    "                +configuration: DeviceClass=MFP & DeviceFunction=Copy & ScannerInput=Flatbed\n",
    "\n",
    "        +overrides:\n",
    "            +Enterprise:\n",
    "                +is_manual:False\n",
    "                +timeout:600\n",
    "                +test:\n",
    "                    +dut:\n",
    "                        +type:Emulator\n",
    "\n",
    "    $$$$$_END_TEST_METADATA_DECLARATION_$$$$$\n",
    "    \"\"\"\n",
    "\n",
    "    def test_when_cancelling_copy_after_initializing_with_flatbed_then_cancelled(\n",
    "        self\n",
    "    ):\n",
    "        # test_copy_job_cancel_flatbed_after_init_cdm_and_state_changes\n",
    "        self.scan_emulation.media.unload_media(\"ADF\")\n",
    "\n",
    "        job_id = self.initialize_copy_job(self.payload)\n",
    "        self.copy.cancel(job_id)\n",
    "\n",
    "        # Wait for job to complete\n",
    "        self.job_queue.wait_for_queue_empty()\n",
    "\n",
    "        # Verify job canceled successfully\n",
    "        history = self.job_history.get()\n",
    "        job_in_history = [job for job in history if job.get('jobId') == job_id]\n",
    "        assert len(job_in_history) == 0, 'Unexpected job in job history!'\n",
    "\n",
    "        # For Simulator default scan resouce is ADF, then need to reload ADF end of testing\n",
    "        self.scan_emulation.media.load_media(\"ADF\", 1)\n"
  ]
}